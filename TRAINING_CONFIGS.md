# è®­ç»ƒé…ç½®å¯¹æ¯”

## ä¸‰ä¸ªç‰ˆæœ¬çš„è®­ç»ƒè„šæœ¬

æ ¹æ®ä½ çš„ç¡¬ä»¶èµ„æºé€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ï¼š

| ç‰¹æ€§ | è½»é‡ç‰ˆ | **å¹³è¡¡ç‰ˆï¼ˆæ¨èï¼‰** | å®Œæ•´ç‰ˆ |
|------|--------|-------------------|--------|
| **è„šæœ¬** | `train_light.py` | `train_balanced.py` | `train.py` |
| **å†…å­˜éœ€æ±‚** | ~2-4 GB | ~4-8 GB | >12 GB |
| **è®­ç»ƒæ—¶é—´** | å¿« | ä¸­ç­‰ | æ…¢ |
| **æ€§èƒ½** | åŸºç¡€ | è‰¯å¥½ | æœ€ä½³ |

---

## è¯¦ç»†é…ç½®å¯¹æ¯”

### 1ï¸âƒ£ è½»é‡ç‰ˆ (train_light.py)

**é€‚ç”¨åœºæ™¯**: å†…å­˜å—é™ã€å¿«é€ŸéªŒè¯

```bash
python train_light.py
```

**é…ç½®**:
- âœ… **ç‰¹å¾**: ä»…åŸå§‹94ä¸ªç‰¹å¾ï¼ˆæ— ç‰¹å¾å·¥ç¨‹ï¼‰
- âœ… **Lookback**: 30
- âœ… **æ¨¡å‹å¤§å°**: å°
  - d_model: 128
  - nhead: 4
  - num_layers: 2
  - dim_feedforward: 512
- âœ… **æ‰¹æ¬¡å¤§å°**: 32
- âœ… **è®­ç»ƒè½®æ•°**: 50
- âœ… **è®¾å¤‡**: CPUï¼ˆç¨³å®šï¼‰

**ä¼˜ç‚¹**:
- ğŸ’š å†…å­˜å ç”¨æœ€å°
- ğŸ’š è®­ç»ƒé€Ÿåº¦æœ€å¿«
- ğŸ’š ç¨³å®šè¿è¡Œ

**ç¼ºç‚¹**:
- ğŸ’” æ€§èƒ½å¯èƒ½è¾ƒå¼±
- ğŸ’” ç‰¹å¾è¡¨è¾¾èƒ½åŠ›æœ‰é™

---

### 2ï¸âƒ£ å¹³è¡¡ç‰ˆ (train_balanced.py) â­ **æ¨è**

**é€‚ç”¨åœºæ™¯**: å¤§å¤šæ•°æƒ…å†µï¼Œæ€§èƒ½ä¸èµ„æºçš„æœ€ä½³å¹³è¡¡

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®
python train_balanced.py

# è‡ªå®šä¹‰é…ç½®
python train_balanced.py \
    --lookback 50 \
    --d_model 256 \
    --batch_size 64 \
    --num_epochs 100
```

**é»˜è®¤é…ç½®**:
- âœ… **ç‰¹å¾**: åŸå§‹ + ç²¾ç®€ç‰¹å¾å·¥ç¨‹
  - æ»åç‰¹å¾: lag 1, 5
  - æ»šåŠ¨ç‰¹å¾: çª—å£10çš„ç§»åŠ¨å¹³å‡
  - åˆ†ç»„ç»Ÿè®¡
  - **é¢„è®¡çº¦ 300-500 ä¸ªç‰¹å¾**
- âœ… **Lookback**: 40
- âœ… **æ¨¡å‹å¤§å°**: ä¸­ç­‰
  - d_model: 192
  - nhead: 6
  - num_layers: 3
  - dim_feedforward: 768
- âœ… **æ‰¹æ¬¡å¤§å°**: 48
- âœ… **è®­ç»ƒè½®æ•°**: 80
- âœ… **è®¾å¤‡**: CUDAï¼ˆå¦‚å¯ç”¨ï¼‰æˆ– CPU

**ä¼˜ç‚¹**:
- ğŸ’š æ€§èƒ½è‰¯å¥½
- ğŸ’š å†…å­˜éœ€æ±‚åˆç†
- ğŸ’š æ”¯æŒå‘½ä»¤è¡Œå‚æ•°å®šåˆ¶
- ğŸ’š æœ€ä½³çš„æ€§ä»·æ¯”

**æ¨èå‚æ•°è°ƒæ•´**:
```bash
# å¦‚æœå†…å­˜å……è¶³ï¼Œå¯ä»¥å¢å¤§æ¨¡å‹
python train_balanced.py --d_model 256 --batch_size 64

# å¦‚æœå†…å­˜ç´§å¼ ï¼Œå¯ä»¥å‡å°
python train_balanced.py --d_model 128 --batch_size 32 --lookback 30

# æ›´é•¿çš„è®­ç»ƒ
python train_balanced.py --num_epochs 150
```

---

### 3ï¸âƒ£ å®Œæ•´ç‰ˆ (train.py)

**é€‚ç”¨åœºæ™¯**: é«˜æ€§èƒ½ç¡¬ä»¶ã€è¿½æ±‚æœ€ä½³æ•ˆæœ

```bash
python train.py \
    --lookback 50 \
    --d_model 256 \
    --num_layers 4 \
    --batch_size 64 \
    --num_epochs 150
```

**é…ç½®**:
- âœ… **ç‰¹å¾**: å®Œæ•´ç‰¹å¾å·¥ç¨‹ï¼ˆå·²ä¼˜åŒ–ï¼‰
  - æ»åç‰¹å¾: lag 1, 5
  - æ»šåŠ¨ç‰¹å¾: çª—å£10
  - åˆ†ç»„ç»Ÿè®¡
  - **å¯èƒ½æœ‰ 500-1000 ä¸ªç‰¹å¾**
- âœ… **Lookback**: 50ï¼ˆå¯è°ƒï¼‰
- âœ… **æ¨¡å‹å¤§å°**: å¤§ï¼ˆå¯è°ƒï¼‰
  - d_model: 256
  - nhead: 8
  - num_layers: 3-6
  - dim_feedforward: 1024
- âœ… **æ‰¹æ¬¡å¤§å°**: 64
- âœ… **è®­ç»ƒè½®æ•°**: 100+

**ä¼˜ç‚¹**:
- ğŸ’š æœ€å¤§çš„è¡¨è¾¾èƒ½åŠ›
- ğŸ’š æ½œåœ¨æœ€ä½³æ€§èƒ½
- ğŸ’š é«˜åº¦å¯å®šåˆ¶

**ç¼ºç‚¹**:
- ğŸ’” å†…å­˜éœ€æ±‚é«˜
- ğŸ’” è®­ç»ƒæ—¶é—´é•¿

---

## å¿«é€Ÿé€‰æ‹©æŒ‡å—

### ğŸ–¥ï¸ æ ¹æ®ç³»ç»Ÿå†…å­˜é€‰æ‹©

| ç³»ç»Ÿå†…å­˜ | æ¨èç‰ˆæœ¬ | å‘½ä»¤ |
|---------|---------|------|
| < 8 GB | è½»é‡ç‰ˆ | `python train_light.py` |
| 8-16 GB | **å¹³è¡¡ç‰ˆ** | `python train_balanced.py` |
| > 16 GB | å®Œæ•´ç‰ˆ | `python train.py --batch_size 64` |

### â±ï¸ æ ¹æ®æ—¶é—´éœ€æ±‚é€‰æ‹©

| æ—¶é—´éœ€æ±‚ | æ¨èç‰ˆæœ¬ | è¯´æ˜ |
|---------|---------|------|
| å¿«é€ŸéªŒè¯ (< 30åˆ†é’Ÿ) | è½»é‡ç‰ˆ | `train_light.py` |
| æ­£å¸¸è®­ç»ƒ (1-2å°æ—¶) | **å¹³è¡¡ç‰ˆ** | `train_balanced.py` |
| æ·±åº¦è®­ç»ƒ (3+å°æ—¶) | å®Œæ•´ç‰ˆ | `train.py --num_epochs 200` |

### ğŸ¯ æ ¹æ®ç›®æ ‡é€‰æ‹©

| ç›®æ ‡ | æ¨èç‰ˆæœ¬ |
|------|---------|
| è¯¾ç¨‹ä½œä¸šå±•ç¤º | **å¹³è¡¡ç‰ˆ** â­ |
| æ¦‚å¿µéªŒè¯ | è½»é‡ç‰ˆ |
| ç«èµ›æäº¤ | å®Œæ•´ç‰ˆ |
| è°ƒè¯•ä»£ç  | è½»é‡ç‰ˆ |

---

## å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹

### å¹³è¡¡ç‰ˆï¼ˆæ¨èä½¿ç”¨ï¼‰

```bash
# é»˜è®¤é…ç½®ï¼ˆæœ€ç®€å•ï¼‰
python train_balanced.py

# ä½¿ç”¨æ›´å¤§çš„æ¨¡å‹
python train_balanced.py \
    --d_model 256 \
    --nhead 8 \
    --num_layers 4 \
    --batch_size 64

# æ›´é•¿çš„è®­ç»ƒæ—¶é—´
python train_balanced.py \
    --num_epochs 120 \
    --early_stopping_patience 15

# ä¸åŒçš„å®éªŒåç§°
python train_balanced.py \
    --experiment_name my_experiment_v1

# åªä½¿ç”¨CPU
python train_balanced.py --device cpu

# ç¦ç”¨ç‰¹å¾å·¥ç¨‹ï¼ˆæ›´è½»é‡ï¼‰
python train_balanced.py \
    --include_lagged False \
    --include_rolling False
```

---

## æ€§èƒ½é¢„æœŸ

åŸºäºå…¸å‹é‡‘èæ—¶é—´åºåˆ—æ•°æ®ï¼š

| ç‰ˆæœ¬ | MSE | RMSE | RÂ² | è®­ç»ƒæ—¶é—´ |
|------|-----|------|-----|---------|
| è½»é‡ç‰ˆ | 0.0008-0.0015 | 0.028-0.038 | 0.2-0.4 | 20-30åˆ†é’Ÿ |
| **å¹³è¡¡ç‰ˆ** | 0.0006-0.0012 | 0.024-0.034 | 0.3-0.5 | 40-80åˆ†é’Ÿ |
| å®Œæ•´ç‰ˆ | 0.0005-0.0010 | 0.022-0.031 | 0.4-0.6 | 90-150åˆ†é’Ÿ |

*æ³¨ï¼šå®é™…æ€§èƒ½å–å†³äºæ•°æ®ç‰¹æ€§å’Œè¶…å‚æ•°è®¾ç½®*

---

## å¯è§†åŒ–ç»“æœ

æ‰€æœ‰ç‰ˆæœ¬è®­ç»ƒå®Œæˆåéƒ½å¯ä»¥ä½¿ç”¨ï¼š

```bash
# æŸ¥çœ‹è®­ç»ƒç»“æœ
python visualize.py --experiment_name <å®éªŒåç§°>

# ç¤ºä¾‹
python visualize.py --experiment_name itransformer_light
python visualize.py --experiment_name itransformer_balanced
```

---

## æ•…éšœæ’é™¤

### å†…å­˜æº¢å‡º (Killed)
```bash
# 1. ä½¿ç”¨æ›´å°çš„æ‰¹æ¬¡
python train_balanced.py --batch_size 24

# 2. å‡å°æ¨¡å‹
python train_balanced.py --d_model 128 --dim_feedforward 512

# 3. ä½¿ç”¨è½»é‡ç‰ˆ
python train_light.py
```

### è®­ç»ƒå¤ªæ…¢
```bash
# 1. å‡å°‘epoch
python train_balanced.py --num_epochs 50

# 2. å¢å¤§batchï¼ˆå¦‚æœå†…å­˜å…è®¸ï¼‰
python train_balanced.py --batch_size 64

# 3. ä½¿ç”¨GPU
python train_balanced.py --device cuda
```

### æ€§èƒ½ä¸ä½³
```bash
# 1. å¢å¤§æ¨¡å‹
python train_balanced.py --d_model 256 --num_layers 4

# 2. æ›´å¤šè®­ç»ƒè½®æ•°
python train_balanced.py --num_epochs 150

# 3. è°ƒæ•´å­¦ä¹ ç‡
python train_balanced.py --learning_rate 5e-5
```

---

## å»ºè®®çš„å·¥ä½œæµç¨‹

### ç¬¬ä¸€æ­¥ï¼šå¿«é€ŸéªŒè¯
```bash
python train_light.py
```
ç¡®è®¤ä»£ç å¯ä»¥æ­£å¸¸è¿è¡Œ

### ç¬¬äºŒæ­¥ï¼šå¹³è¡¡è®­ç»ƒï¼ˆæ¨èï¼‰
```bash
python train_balanced.py
```
è·å¾—åˆç†çš„æ€§èƒ½

### ç¬¬ä¸‰æ­¥ï¼šç”ŸæˆæŠ¥å‘Š
```bash
python visualize.py --experiment_name itransformer_balanced
```

### ç¬¬å››æ­¥ï¼ˆå¯é€‰ï¼‰ï¼šä¼˜åŒ–
å¦‚æœéœ€è¦æ›´å¥½çš„ç»“æœï¼š
```bash
python train_balanced.py \
    --d_model 256 \
    --num_layers 4 \
    --num_epochs 120 \
    --experiment_name itransformer_optimized
```

---

**æ¨è**: å¯¹äºè¯¾ç¨‹é¡¹ç›®ï¼Œä½¿ç”¨ `train_balanced.py` è¶³ä»¥è·å¾—è‰¯å¥½çš„ç»“æœï¼ğŸ“

